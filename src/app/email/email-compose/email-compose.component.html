<div class="container mt-4">
    <h2>Nowa wiadomość</h2>
    <form [formGroup]="form" (ngSubmit)="send()">

        <!-- Wybór szablonu -->
        <div class="mb-3 mt-4">
            <label>Szablon</label>
            <select formControlName="templateId" class="form-select ml-2">
                <option value="">(Brak)</option>
                <option *ngFor="let t of templates" [value]="t.id">{{ t.name }}</option>
            </select>
            <small class="text-muted d-block mt-1">
                Pola typu data/godzina wybierzesz z kalendarza i zegara.
            </small>
        </div>
        <!-- Zmienne z szablonu -->
        <div *ngIf="placeholderKeys.length" formGroupName="variables" class="mb-3">
            <div *ngFor="let key of placeholderKeys" class="mb-3">
                <label class="form-label">{{ key }}</label>
                <ng-container [ngSwitch]="variableTypes[key]">
                    <!-- DATA -->
                    <input
                            *ngSwitchCase="'date'"
                            [formControlName]="key"
                            class="form-control"
                            type="date"
                    />
                    <!-- GODZINA -->
                    <input
                            *ngSwitchCase="'time'"
                            [formControlName]="key"
                            class="form-control"
                            type="time"
                    />
                    <!-- TEKST -->
                    <input
                            *ngSwitchDefault
                            [formControlName]="key"
                            class="form-control"
                            type="text"
                    />
                </ng-container>
            </div>
        </div>
        <hr>

        <div class="mb-3 mt-4">
            <label>Do</label>
            <input formControlName="to" class="form-control">
            <div *ngIf="form.get('to')?.invalid && form.get('to')?.touched" class="text-danger small">
                Podaj poprawny adres email
            </div>
        </div>
        <div class="mb-3">
            <label>Temat</label>
            <input formControlName="subject" class="form-control">
            <div *ngIf="form.get('subject')?.invalid && form.get('subject')?.touched" class="text-danger small">
                Podaj temat
            </div>
        </div>
        <div class="mb-4">
            <label>Treść</label>
            <textarea formControlName="body" rows="8" class="form-control"></textarea>
            <div *ngIf="form.get('body')?.invalid && form.get('body')?.touched" class="text-danger small">
                Wpisz treść wiadomości
            </div>
            <small class="text-muted d-block mt-1">
                Daty są automatycznie formatowane po polsku (np. "sobota, 9 sierpnia 2025").
            </small>
        </div>
        <button class="btn btn-primary" type="submit" [disabled]="form.invalid || sending">Wyślij</button>
        <button class="btn btn-secondary ms-2 ml-2" type="button" (click)="cancel()">Anuluj</button>
        <div *ngIf="error" class="text-danger mt-3">{{ error }}</div>
    </form>
</div>
