<div class="card">
  <div class="card-header d-flex align-items-center justify-content-between">
    <div>
      Szczegóły
      <small *ngIf="selected" class="text-muted">– {{ selected.subject }}</small>
    </div>
    <button class="btn btn-sm btn-outline-secondary" (click)="onExportClicks()" [disabled]="!selected">
      Eksport kliknięć (CSV)
    </button>
  </div>

  <div class="card-body">
    <!-- Filtry -->
    <div class="row g-2 mb-3">
      <div class="col">
        <label class="form-label mb-1">Odbiorca</label>
        <input class="form-control form-control-sm"
               placeholder="np. jan@firma.pl"
               [(ngModel)]="filterRecipient"
               (ngModelChange)="onFiltersChange()">
      </div>
      <div class="col">
        <label class="form-label mb-1">URL</label>
        <input class="form-control form-control-sm"
               placeholder="np. /oferta"
               [(ngModel)]="filterUrl"
               (ngModelChange)="onFiltersChange()">
      </div>
    </div>

    <!-- Wykres czasu -->
    <div class="card mb-3">
      <div class="card-header">Kliknięcia w czasie (po filtrach)</div>
      <div class="card-body chart-holder small-chart">
        <canvas #timeChart></canvas>
      </div>
    </div>

    <!-- Tabela klików -->
    <div class="table-responsive" style="max-height: 320px; overflow:auto;">
      <table class="table table-sm align-middle">
        <thead>
        <tr>
          <th>Data</th>
          <th>Odbiorca</th>
          <th>URL</th>
          <th>IP</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let c of filteredClicks">
          <td>{{ c.ts | date:'short' }}</td>
          <td>{{ c.recipient || '—' }}</td>
          <td style="max-width: 380px">
            <a [href]="c.url" target="_blank" rel="noopener noreferrer">{{ c.url }}</a>
          </td>
          <td>{{ c.ip || '—' }}</td>
        </tr>
        <tr *ngIf="selected && !filteredClicks.length">
          <td colspan="4" class="text-center text-muted">Brak wyników dla zastosowanych filtrów</td>
        </tr>
        <tr *ngIf="!selected">
          <td colspan="4" class="text-center text-muted">Wybierz wiadomość w podsumowaniu</td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
